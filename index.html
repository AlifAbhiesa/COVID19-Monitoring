<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>COVID-19 Monitoring by IF TEAM</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->

  <link rel="stylesheet" href="plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="plugins/datatables-responsive/css/responsive.bootstrap4.min.css">

  <link rel="stylesheet" href="plugins/select2/css/select2.min.css">
  <link rel="stylesheet" href="plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
  <link rel="stylesheet" href="plugins/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <!-- Custom Styles -->
  <link rel="stylesheet" href="dist/css/styles.css">
  <!-- Google Font: Source Sans Pro -->
  <link
    href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&display=swap"
    rel="stylesheet">
</head>

<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <nav class="navbar navbar-expand-lg navbar-light bg-white">
      <a href="http://covid.itenas.tech">
        <img src="https://www.itenas.ac.id/wp-content/uploads/2019/01/Logo-itenas-04.png" height="60px" width="140px" />
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="http://covid.itenas.tech/faq.html">Faq</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://covid.itenas.tech/kasusSekitar.html">Kasus Disekitar</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="http://covid.itenas.tech/contacts.html">Contacts</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/AlifAbhiesa/COVID19-Monitoring">Developer Area</a>
          </li>

        </ul>
      </div>
    </nav>
    <!-- Content Wrapper. Contains page content -->
    <div style="margin-left: 0px; padding-top: 2%;" class="content-wrapper">
      <!-- Content Header (Page header) -->
      <a id="scroll-top"><i class="fas fa-angle-up"></i></a>
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="mb-2 text-dark" style="font-weight: 700;">COVID-19 Monitoring</h1>
              <h3 class="btn btn-secondary btn-sm">
                <label id="country"> Country </label>/
                <label id="date"> Date </label>
              </h3>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <select onchange="getData()" id="countrySelect" class="form-control select2bs4" data-select2-id="1"
                tabindex="-1" aria-hidden="true" style="max-width: 100%;">
                <option selected="selected" value="Indonesia">--- Pilih Negara --</option>
              </select>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Main content -->
      <div class="content">
        <div class="container-fluid">
          <div class="card">
            <div class="card-header">
              <h3>Statistik</h3>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="positif">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-positif">Positif</a>
                  </div>
                </div>

                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="sembuh">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-sembuh">Sembuh</a>
                  </div>
                </div>

                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="meninggal">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-meninggal">Meninggal</a>
                  </div>
                </div>
              </div>

              <div id="rowMore" class="row rowMoreHidden">
                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="aktif">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-positif">Aktif</a>
                  </div>
                </div>

                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="kasus">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-sembuh">Kasus Hari Ini</a>
                  </div>
                </div>

                <div class="col-lg-4">
                  <div class="small-box bg-white">
                    <div class="inner">
                      <h3 id="kematian">150</h3>
                    </div>
                    <a href="#" class="small-box-footer bg-meninggal">Kematian Hari Ini</a>
                  </div>
                </div>
              </div>
              <div class="row btnMore">
                <div class="col-lg-12">
                  <button type="button" id="showMore" class="btn btn-lg btn-block btn-secondary">More <i
                      class="fas fa-angle-double-down" style="margin-left: 10px;"></i></button>
                </div>
              </div>
            </div>
          </div>

          <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <div class="card">
              <div class="card-header">
                <h3>Data Per Provinsi</h2>
              </div>
              <div class="card-body">
                <div id="courselItemProv" class="carousel-inner">
                  <div class="carousel-item active">

                    <div class="card" style="box-shadow: 0 0 13px 0 rgba(82, 63, 105, .05)">
                      <div class="card-header">
                      </div>
                      <div class="card-body">
                        <center style="font-family: monospace;">Swipe ke kiri untuk melihat data kasus setiap provinsi
                        </center>
                      </div>
                    </div>


                  </div>

                </div>
              </div>
            </div>

            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
              <i class="fas fa-chevron-left"></i>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
              <i class="fas fa-chevron-right"></i>
              <span class="sr-only">Next</span>
            </a>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Data Statistik</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"
                    style="color: white;"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"
                    style="color: white"></i></button>
              </div>
            </div>
            <div class="card-body">
              <div class="chart">
                <div class="chartjs-size-monitor">
                  <div class="chartjs-size-monitor-expand">
                    <div class=""></div>
                  </div>
                  <div class="chartjs-size-monitor-shrink">
                    <div class=""></div>
                  </div>
                </div>
                <canvas id="barChart"
                  style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%; display: block;"
                  width="313" height="250" class="chartjs-render-monitor"></canvas>
              </div>
            </div>
            <!-- /.card-body -->
          </div>

          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Detail Data Harian</h3>
                </div>
                <!-- /.card-header -->
                <div class="card-body">
                  <table id="example1" class="table table-bordered table-striped">
                    <thead>
                      <tr>
                        <th>Tanggal</th>
                        <th>Positif</th>
                        <th>Sembuh</th>
                        <th>Meninggal</th>
                      </tr>
                    </thead>
                    <tbody id="tableBody">


                    </tbody>
                  </table>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
            </div>
            <!-- /.col -->
          </div>


          <div class="row py-4">
            <div class="card">
              <div class="card-header">
                <h3>Berita Terbaru</h3>
              </div>
              <div class="card-body">
                <div id="newsPlace" style="overflow-x:auto;width:100%;height:100%;display:flex">

                </div>
              </div>
            </div>
          </div>


          <div class="card">
            <div class="card-header">
              <h3 class="card-title">API DATA</h3>

              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>
                </button>
                <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                    class="fas fa-times"></i></button>
              </div>
            </div>
            <div class="card-body">
              <h2>API DATA</h2>
              <ul class="list-no-style">
                <li>
                  <a href="https://github.com/mathdroid/covid-19-api" class="btn btn-secondary">
                    https://github.com/mathdroid/covid-19-api
                  </a>
                </li>
                <li href=" https://github.com/pomber/covid19" class="btn btn-secondary">
                  https://github.com/pomber/covid19
                </li>
              </ul>
              <h2>Data Source</h2>
              <ul class="list-no-style">
                <li>
                  <a href="https://www.who.int/" class="btn btn-secondary">
                    World Health Organization (WHO)
                  </a>
                </li>
                <li>
                  <a href="http://3g.dxy.cn/newh5/view/pneumonia" class="btn btn-secondary">
                    DXY.cn. Pneumonia. 2020.
                  </a>
                </li>
                <li>
                  <a href="https://bnonews.com/index.php/2020/02/the-latest-coronavirus-cases/"
                    class="btn btn-secondary">
                    BNO News:
                  </a>
                </li>
                <li>
                  <a href="http://www.nhc.gov.cn/xcs/yqtb/list_gzbd.shtml" class="btn btn-secondary">
                    National Health Commission of the People’s Republic of China (NHC):
                  </a>
                </li>
                etc.
              </ul>
              <h2>News Source</h2>
              <ul class="list-no-style">
                <li>
                  <a href="https://www.detik.com" class="btn btn-secondary">
                    Detik.com
                  </a>
                </li>
              </ul>
              <h2>License</h2>
              <p>MIT License 2020, HMIF.<br>
                Transitively from the John Hopkins Site, the data may not be used for commercial purposes.</p>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content -->
      <!-- Main Footer -->
      <footer style="margin-left: 0px;" class="main-footer">
        <!-- To the right -->
        <div class="float-right d-none d-sm-inline">
          Made by &#x2665;
        </div>
        <!-- Default to the left -->
        <strong>Copyright &copy; 2020 <a
            href="https://github.com/AlifAbhiesa/COVID19-Monitoring/graphs/contributors">HMIF
            TEAM</a>.</strong> All rights reserved.
      </footer>
    </div>
    <!-- /.content-wrapper -->
  </div>
  <!-- ./wrapper -->


  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div style="background: white;" class="modal-content p-5">
        <div class="">
          <center><img src="source.gif" width="100px" height="100px"></center>
        </div>
        <button hidden id="closeModal" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>

  <!-- jQuery -->
  <script src="plugins/jquery/jquery.min.js"></script>
  <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE App -->
  <script src="plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
  <script src="plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
  <script src="plugins/select2/js/select2.full.min.js"></script>
  <script src="dist/js/adminlte.min.js"></script>
  <script src="plugins/chart.js/Chart.min.js"></script>
  <!-- News Feeds API -->
  <script src="news.js"></script>

  <script>
    // Button Scroll Top
    const btnScrollTop = $('#scroll-top');

    $(window).scroll(function () {
      if ($(window).scrollTop() > 300) {
        btnScrollTop.addClass('show');
      } else {
        btnScrollTop.removeClass('show');
      }
    });

    btnScrollTop.on('click', function (e) {
      e.preventDefault();
      $('html, body').animate({
        scrollTop: 0
      }, '300');
    });
    $('.select2bs4').select2({
      theme: 'bootstrap4'
    });

    // change icons
    $('#showMore').click(function () {
      $(this).find('i').toggleClass('fa-angle-double-down fa-angle-double-up');
      $("#rowMore").toggleClass('rowMoreHidden');
      $("#rowMore").toggleClass('animatee');
    });

    getData();

    function getData() {
      getNews();

      hideShowDataProvinsi();

      $('#exampleModalCenter').modal('toggle');


      var country = document.getElementById("countrySelect").value;
      $('#example1').dataTable().fnDestroy();
      var table = $("#example1").DataTable({
        "responsive": true,
        "autoWidth": false,
        "order": [
          [0, "desc"]
        ]
      });


      var chartDataMeninggal = [];
      var chartDataSembuh = [];
      var chartDataPositif = [];
      var chartLabel = [];

      // dat card country positif meninggal sembuh
      $.ajax({
        url: "https://covid19.mathdro.id/api/countries/" + country,
        type: "GET",
        success: function (response) {
          $('#date').text(response.lastUpdate);
          response.confirmed.value ? $('#positif').text(response.confirmed.value.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#positif').text('Not available yet today');
          response.deaths.value ? $('#meninggal').text(response.deaths.value.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#meninggal').text('Not available yet today');
          response.recovered.value ? $('#sembuh').text(response.recovered.value.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#sembuh').text('Not available yet today');
        },
        error: function () {
          alert('error');
        }
      });

      //dat card indonesia aktif kasus kematian
      $.ajax({
        url: "https://corona.lmao.ninja/countries/" + country,
        type: "GET",
        success: function (response) {
          response.active ? $('#aktif').text(response.active.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#aktif').text('Not available yet today');
          response.todayCases ? $('#kasus').text(response.todayCases.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#kasus').text('Not available yet today');
          response.todayDeaths ? $('#kematian').text(response.todayDeaths.toString().replace(
            /(\d)(?=(\d{3})+(?!\d))/g, '$1,')) : $('#kematian').text('Not available yet today');
        },
        error: function () {
          alert('error');
        }
      });


      //data bar chart
      $.ajax({
        url: "https://pomber.github.io/covid19/timeseries.json",
        type: "GET",
        success: function (response) {
          var date = new Date();
          var date2 = date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
          var lastData = response[country].length - 1;
          var data = response[country][lastData];
          $('#country').text(country);

          for (i = response[country].length - 11; i < response[country].length; i++) {
            response[country][i].confirmed ? chartDataPositif.push(response[country][i].confirmed) :
              chartDataPositif.push(0);
            response[country][i].deaths ? chartDataMeninggal.push(response[country][i].deaths) :
              chartDataMeninggal.push(0);
            response[country][i].recovered ? chartDataSembuh.push(response[country][i].recovered) :
              chartDataSembuh.push(0);
            response[country][i].date ? chartLabel.push(response[country][i].date) : chartLabel.push(0);
          }

          chartShowData(chartDataPositif, chartDataSembuh, chartDataMeninggal, chartLabel);


        },
        error: function () {
          alert("error");
        }

      });

      // data country 

      $.ajax({
        url: "https://covid19.mathdro.id/api/countries",
        type: "GET",
        success: function (response) {

          for (i = 0; i < response["countries"].length; i++) {
            $('#countrySelect')
              .append($("<option></option>")
                .attr("value", response["countries"][i]["name"])
                .text(response["countries"][i]["name"] + ' - ' + response["countries"][i]["iso3"]));
          }

        },
        error: function () {
          alert("error");
        }

      });

      // kasus per provinsi
      $.ajax({
        url: "https://indonesia-covid-19.mathdro.id/api/provinsi",
        type: "GET",
        success: function (response) {


          for (i = 0; i < response['data'].length; i++) {
            if (response['data'][i]['provinsi'] != "Indonesia") {
              $('#courselItemProv').append('<div class="carousel-item">' +
                '<div class="card">' +
                '<div class="card-header">' +
                '<h3><center>' + response[
                  'data'][i]['provinsi'] + '</center> </h3>' +
                '</div>' +
                '<div class="card-body">' +
                '<div class="row" style="padding: 15px">' +
                '<div class="col-lg-4">' +
                '<div class="small-box bg-white">' +
                '<div class="inner">' +
                ' <h3 id="positif">' + response['data'][i]['kasusPosi'] + '</h3>' +
                '</div>' +
                '<a href="#" class="small-box-footer bg-positif">Positif</a>' +
                '</div>' +
                '</div>' +

                '<div class="col-lg-4">' +
                '<div class="small-box bg-white">' +
                '<div class="inner">' +
                ' <h3 id="sembuh">' + response['data'][i]['kasusSemb'] + '</h3>' +
                '</div>' +
                '<a href="#" class="small-box-footer bg-sembuh">Sembuh</a>' +
                '</div>' +
                '</div>' +

                '<div class="col-lg-4">' +
                '<div class="small-box bg-white">' +
                '<div class="inner">' +
                ' <h3 id="meninggal">' + response['data'][i]['kasusMeni'] + '</h3>' +
                '</div>' +
                '<a href="#" class="small-box-footer bg-meninggal">Meninggal</a>' +
                '</div>' +
                '</div>' +

                '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                '</div>');
            }
          }
        },
        error: function () {
          alert("error");
        }

      });
    }

    function hideShowDataProvinsi() {
      var country = document.getElementById("countrySelect").value;

      if (country != "Indonesia") {
        $('#carouselExampleIndicators').css('display', 'none');
      } else {
        $('#carouselExampleIndicators').css('display', 'block');
      }
    }


    function chartShowData(chartDataPositif, chartDataSembuh, chartDataMeninggal, chartLabel) {

      drawTable2(chartDataPositif, chartDataSembuh, chartDataMeninggal, chartLabel);

      var areaChartData = {
        labels: chartLabel,
        datasets: [{
            label: 'Positif',
            backgroundColor: 'rgba(255, 146, 52, .8)',
            borderColor: 'rgba(255, 146, 52, .8)',
            pointRadius: false,
            pointColor: '#3b8bba',
            pointStrokeColor: 'rgba(60,141,188,1)',
            pointHighlightFill: '#fff',
            pointHighlightStroke: 'rgba(60,141,188,1)',
            data: chartDataPositif,
          },
          {
            label: 'Meninggal',
            backgroundColor: 'rgba(216, 35, 42, .8)',
            borderColor: 'rgba(216, 35, 42, .8)',
            pointRadius: false,
            pointColor: 'rgba(210, 214, 222, 1)',
            pointStrokeColor: '#c1c7d1',
            pointHighlightFill: '#fff',
            pointHighlightStroke: 'rgba(220,220,220,1)',
            data: chartDataMeninggal,
          },
          {
            label: 'Sembuh',
            backgroundColor: 'rgba(33, 150, 83, .8)',
            borderColor: 'rgba(33, 150, 83, .8)',
            pointRadius: false,
            pointColor: 'rgba(210, 214, 222, 1)',
            pointStrokeColor: '#c1c7d1',
            pointHighlightFill: '#fff',
            pointHighlightStroke: 'rgba(220,220,220,1)',
            data: chartDataSembuh,
          },
        ]
      }

      var barChartCanvas = $('#barChart').get(0).getContext('2d')
      var barChartData = jQuery.extend(true, {}, areaChartData)


      var barChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        datasetFill: false
      }

      var barChart = new Chart(barChartCanvas, {
        type: 'bar',
        data: barChartData,
        options: barChartOptions
      })

      //---------------------
      //- STACKED BAR CHART -
      //---------------------
      var stackedBarChartCanvas = $('#stackedBarChart').get(0).getContext('2d')
      var stackedBarChartData = jQuery.extend(true, {}, barChartData)

      var stackedBarChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          xAxes: [{
            stacked: true,
          }],
          yAxes: [{
            stacked: true
          }]
        }
      }

      var stackedBarChart = new Chart(stackedBarChartCanvas, {
        type: 'bar',
        data: stackedBarChartData,
        options: stackedBarChartOptions
      })

    }

    function drawTable2(chartDataPositif, chartDataSembuh, chartDataMeninggal, chartLabel) {
      // setTimeout(
      // function() 
      // {
      //   $( "#closeModal" ).click();
      // }, 3000);

      var table = $("#example1").DataTable();
      table.clear();

      for (i = 0; i < chartDataPositif.length; i++) {
        table.row.add([
            chartLabel[i], chartDataPositif[i], chartDataSembuh[i], chartDataMeninggal[i]
          ])
          .draw(false);

        // console.log(chartDataPositif);
      }
    }
  </script>
</body>

</html>